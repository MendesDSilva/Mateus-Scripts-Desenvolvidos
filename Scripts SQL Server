/* CONECTANDO A UM BANCO */

CREATE DATABASE EMPRESA
GO

USE EMPRESA 
GO

/* CRIANDO TABELA */ 

CREATE TABLE ALUNO
(
	IDALUNO INT PRIMARY KEY IDENTITY,
	NOME VARCHAR(30) NOT NULL,
	SEXO CHAR(1) NOT NULL,
	NASCIMENTO DATE NOT NULL,
	EMAIL VARCHAR(30) UNIQUE

)
GO 

/* RELACIONAMENTO 1 X 1 */

CREATE TABLE ENDERECO
(
	IDENDERECO INT PRIMARY KEY IDENTITY(100,10), /* INCREMENTA DE 10 EM 10 */
	BAIRRO VARCHAR(30),
	UF CHAR(2) NOT NULL CHECK(UF IN('RJ','SP','MG')),
	ID_ALUNO INT UNIQUE
)
GO

/* INSERINDO DADOS TABELA ENDERECO */

INSERT INTO ENDERECO VALUES('FLAMENGO','RJ',1)
INSERT INTO ENDERECO VALUES('MORUMBI','SP',2)
INSERT INTO ENDERECO VALUES('CENTRO','MG',4)
INSERT INTO ENDERECO VALUES('CENTRO','SP',6)
GO


/* CRIANDO CHAVE ESTRANGEIRA */ 

ALTER TABLE ENDERECO
ADD CONSTRAINT FK_ENDERECO_ALUNO
FOREIGN KEY (ID_ALUNO)
REFERENCES ALUNO (IDALUNO)

GO

/* COMANDOS DE DESCRIÇÃO */

/* PROCEDURES - JÁ CRIADAS E ARMAZENADA NO SISTEMA */ 

SP_COLUMNS ALUNO /* DESC TABELA ALUNO */
GO

SP_HELP ALUNO /* DESC TABELA ALUNO MAIS DETALHADO */
GO

/* INSERINDO DADOS */

INSERT INTO ALUNO VALUES('ANDRE','M','1981/12/09','ANDRE@IG.COM')
INSERT INTO ALUNO VALUES('ANA','F','1978/03/09','ANA@IG.COM')
INSERT INTO ALUNO VALUES('RUI','M','1965/07/09','RUI@IG.COM')
INSERT INTO ALUNO VALUES('JOAO','M','2002/11/09','JOAO@IG.COM')
GO



CREATE TABLE TELEFONE
(
	IDTELEFONE INT PRIMARY KEY IDENTITY,
	TIPO CHAR(3) NOT NULL CHECK(TIPO IN('RES','COM','CEL')), /* CHECK ENUM MySQL */
	NUMERO VARCHAR(10) NOT NULL,
	ID_ALUNO INT
)
GO

/* INSERINDO DADOS TABELA TELEFONE */

INSERT INTO TELEFONE VALUES('CEL','7874548',1)
INSERT INTO TELEFONE VALUES('RES','4744558',1)
INSERT INTO TELEFONE VALUES('COM','4214525',2)
INSERT INTO TELEFONE VALUES('CEL','4445487',2)
GO

/* PEGAR DATA ATUAL */ 

SELECT GETDATE()
GO

/* CLAUSULA AMBIGUA INNER JOIN, TRAS TODOS OS ALUNOS QUE POSSUEM TELEFONE */

SELECT ALUNO.NOME, TELEFONE.TIPO, TELEFONE.NUMERO, ENDERECO.BAIRRO, ENDERECO.UF
FROM ALUNO 	
INNER JOIN TELEFONE 
ON ALUNO.IDALUNO = TELEFONE.ID_ALUNO
INNER JOIN ENDERECO
ON ALUNO.IDALUNO = ENDERECO.ID_ALUNO
GO


/* LEFT JOIN TRÁS TODOS OS ALUNOS, MESMO SEM TELEFONE */

SELECT ALUNO.NOME, TELEFONE.TIPO, TELEFONE.NUMERO, ENDERECO.BAIRRO, ENDERECO.UF
FROM ALUNO 	
LEFT JOIN TELEFONE 
ON ALUNO.IDALUNO = TELEFONE.ID_ALUNO
INNER JOIN ENDERECO
ON ALUNO.IDALUNO = ENDERECO.ID_ALUNO
GO



/* ISNULL (MySQL IFNULL) */

SELECT 

	ALUNO.NOME, 
	ISNULL(TELEFONE.TIPO,'SEM') AS "TIPO", 
	ISNULL(TELEFONE.NUMERO,'NUMERO') AS "TELEFONE", 
	ENDERECO.BAIRRO, 
	ENDERECO.UF

FROM ALUNO 	
LEFT JOIN TELEFONE 
ON ALUNO.IDALUNO = TELEFONE.ID_ALUNO
INNER JOIN ENDERECO
ON ALUNO.IDALUNO = ENDERECO.ID_ALUNO
GO



/* DATAS */ 

SELECT NOME, NASCIMENTO
FROM ALUNO
GO

/* DATEDIFF CALCULA DIFERENÇA ENTRE DUAS DATAS */

/* GETDATE() TRAZ DIA E HORA */


SELECT NOME, GETDATE() AS DATA_ALUNO FROM ALUNO
GO

/* PRIMEIRO PASSO DIFERENÇA EM DIAS */

SELECT NOME, DATEDIFF(DAY,NASCIMENTO,GETDATE()) AS
FROM ALUNO
GO

/* SEGUNDO PASSO IDADE DO ALUNO */

SELECT NOME, DATEDIFF(YEAR,NASCIMENTO,GETDATE()) AS
FROM ALUNO
GO
